/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/runtime","rxjs","@grafana/data","lodash"],(function(e,t,r,n,o,i){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=8)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t,r){"use strict";(function(e){var n=r(0),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=void 0;s="undefined"!=typeof window?window:"undefined"!=typeof self?self:e;var l=null,f=null,p=s.clearTimeout,d=s.setTimeout,h=s.cancelAnimationFrame||s.mozCancelAnimationFrame||s.webkitCancelAnimationFrame,y=s.requestAnimationFrame||s.mozRequestAnimationFrame||s.webkitRequestAnimationFrame;function v(e){var t=void 0,r=void 0,n=void 0,o=void 0,i=void 0,a=void 0,u=void 0,c="undefined"!=typeof document&&document.attachEvent;if(!c){a=function(e){var t=e.__resizeTriggers__,r=t.firstElementChild,n=t.lastElementChild,o=r.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,o.style.width=r.offsetWidth+1+"px",o.style.height=r.offsetHeight+1+"px",r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight},i=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},u=function(e){if(!(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)){var t=this;a(this),this.__resizeRAF__&&l(this.__resizeRAF__),this.__resizeRAF__=f((function(){i(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(r){r.call(t,e)})))}))}};var p=!1,d="";n="animationstart";var h="Webkit Moz O ms".split(" "),y="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),v=document.createElement("fakeelement");if(void 0!==v.style.animationName&&(p=!0),!1===p)for(var b=0;b<h.length;b++)if(void 0!==v.style[h[b]+"AnimationName"]){d="-"+h[b].toLowerCase()+"-",n=y[b],p=!0;break}t="@"+d+"keyframes "+(r="resizeanim")+" { from { opacity: 0; } to { opacity: 0; } } ",o=d+"animation: 1ms "+r+"; "}return{addResizeListener:function(i,l){if(c)i.attachEvent("onresize",l);else{if(!i.__resizeTriggers__){var f=i.ownerDocument,p=s.getComputedStyle(i);p&&"static"===p.position&&(i.style.position="relative"),function(r){if(!r.getElementById("detectElementResize")){var n=(t||"")+".resize-triggers { "+(o||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',i=r.head||r.getElementsByTagName("head")[0],a=r.createElement("style");a.id="detectElementResize",a.type="text/css",null!=e&&a.setAttribute("nonce",e),a.styleSheet?a.styleSheet.cssText=n:a.appendChild(r.createTextNode(n)),i.appendChild(a)}}(f),i.__resizeLast__={},i.__resizeListeners__=[],(i.__resizeTriggers__=f.createElement("div")).className="resize-triggers";var d=f.createElement("div");d.className="expand-trigger",d.appendChild(f.createElement("div"));var h=f.createElement("div");h.className="contract-trigger",i.__resizeTriggers__.appendChild(d),i.__resizeTriggers__.appendChild(h),i.appendChild(i.__resizeTriggers__),a(i),i.addEventListener("scroll",u,!0),n&&(i.__resizeTriggers__.__animationListener__=function(e){e.animationName===r&&a(i)},i.__resizeTriggers__.addEventListener(n,i.__resizeTriggers__.__animationListener__))}i.__resizeListeners__.push(l)}},removeResizeListener:function(e,t){if(c)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",u,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(n,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}null==h||null==y?(l=p,f=function(e){return d(e,20)}):(l=function(e){var t=c(e,2),r=t[0],n=t[1];h(r),p(n)},f=function(e){var t=y((function(){p(r),e()})),r=d((function(){h(t),e()}),20);return[t,r]});var b=function(e){function t(){var e,r,n;o(this,t);for(var i=arguments.length,a=Array(i),c=0;c<i;c++)a[c]=arguments[c];return r=n=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n.state={height:n.props.defaultHeight||0,width:n.props.defaultWidth||0},n._onResize=function(){var e=n.props,t=e.disableHeight,r=e.disableWidth,o=e.onResize;if(n._parentNode){var i=n._parentNode.offsetHeight||0,a=n._parentNode.offsetWidth||0,u=window.getComputedStyle(n._parentNode)||{},c=parseInt(u.paddingLeft,10)||0,s=parseInt(u.paddingRight,10)||0,l=parseInt(u.paddingTop,10)||0,f=parseInt(u.paddingBottom,10)||0,p=i-l-f,d=a-c-s;(!t&&n.state.height!==p||!r&&n.state.width!==d)&&(n.setState({height:i-l-f,width:a-c-s}),o({height:i,width:a}))}},n._setRef=function(e){n._autoSizer=e},u(n,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentDidMount",value:function(){var e=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=v(e),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.className,o=e.disableHeight,i=e.disableWidth,u=e.style,c=this.state,s=c.height,l=c.width,f={overflow:"visible"},p={},d=!1;return o||(0===s&&(d=!0),f.height=0,p.height=s),i||(0===l&&(d=!0),f.width=0,p.width=l),Object(n.createElement)("div",{className:r,ref:this._setRef,style:a({},f,u)},!d&&t(p))}}]),t}(n.PureComponent);b.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}},t.a=b}).call(this,r(7))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";r.r(t);var n=r(4),o=r(1),i=r(0),a=r.n(i),u=r(5),c=r(6);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function d(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function u(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,u)}c((n=n.apply(e,t||[])).next())}))}function h(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}Object.create;function y(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function b(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}function m(e){return this instanceof m?(this.v=e,this):new m(e)}function g(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),i=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){o[e]&&(n[e]=function(t){return new Promise((function(r,n){i.push([e,t,r,n])>1||u(e,t)}))})}function u(e,t){try{(r=o[e](t)).value instanceof m?Promise.resolve(r.value.v).then(c,s):l(i[0][2],r)}catch(e){l(i[0][3],e)}var r}function c(e){u("next",e)}function s(e){u("throw",e)}function l(e,t){e(t),i.shift(),i.length&&u(i[0][0],i[0][1])}}function _(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=y(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,o){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,o,(t=e[r](t)).done,t.value)}))}}}Object.create;var w=r(2),S=r(3);function O(e){return"function"==typeof e}function x(e){return function(t){if(function(e){return O(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var j,E=((j=function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}((function(e){Error.call(e),e.stack=(new Error).stack}))).prototype=Object.create(Error.prototype),j.prototype.constructor=j,j);function T(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var z=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var a=y(i),u=a.next();!u.done;u=a.next()){u.value.remove(this)}}catch(t){e={error:t}}finally{try{u&&!u.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if(O(c))try{c()}catch(e){o=e instanceof E?e.errors:[e]}var s=this._finalizers;if(s){this._finalizers=null;try{for(var l=y(s),f=l.next();!f.done;f=l.next()){var p=f.value;try{P(p)}catch(e){o=null!=o?o:[],e instanceof E?o=b(b([],v(o)),v(e.errors)):o.push(e)}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}}if(o)throw new E(o)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)P(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&T(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&T(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();z.EMPTY;function A(e){return e instanceof z||e&&"closed"in e&&O(e.remove)&&O(e.add)&&O(e.unsubscribe)}function P(e){O(e)?e():e.unsubscribe()}var k={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},R={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=R.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,b([e,t],v(r))):setTimeout.apply(void 0,b([e,t],v(r)))},clearTimeout:function(e){var t=R.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function C(e){R.setTimeout((function(){var t=k.onUnhandledError;if(!t)throw e;t(e)}))}function F(){}var N=I("C",void 0,void 0);function I(e,t,r){return{kind:e,value:t,error:r}}var L=null;var M=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,A(t)&&t.add(r)):r.destination=B,r}return p(t,e),t.create=function(e,t,r){return new H(e,t,r)},t.prototype.next=function(e){this.isStopped?U(function(e){return I("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?U(I("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?U(N,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(z),V=Function.prototype.bind;function D(e,t){return V.call(e,t)}var q=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){W(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){W(e)}else W(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){W(e)}},e}(),H=function(e){function t(t,r,n){var o,i,a=e.call(this)||this;O(t)||!t?o={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:a&&k.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return a.unsubscribe()},o={next:t.next&&D(t.next,i),error:t.error&&D(t.error,i),complete:t.complete&&D(t.complete,i)}):o=t;return a.destination=new q(o),a}return p(t,e),t}(M);function W(e){var t;k.useDeprecatedSynchronousErrorHandling?(t=e,k.useDeprecatedSynchronousErrorHandling&&L&&(L.errorThrown=!0,L.error=t)):C(e)}function U(e,t){var r=k.onStoppedNotification;r&&R.setTimeout((function(){return r(e,t)}))}var B={closed:!0,next:F,error:function(e){throw e},complete:F};function J(e,t,r,n,o){return new Q(e,t,r,n,o)}var Q=function(e){function t(t,r,n,o,i,a){var u=e.call(this,t)||this;return u.onFinalize=i,u.shouldUnsubscribe=a,u._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,u._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,u}return p(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(M);function $(e,t){return x((function(r,n){var o=0;r.subscribe(J(n,(function(r){n.next(e.call(t,r,o++))})))}))}var Y="function"==typeof Symbol&&Symbol.observable||"@@observable";function G(e){return e}function K(e){return 0===e.length?G:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var X=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,o=this,i=(n=e)&&n instanceof M||function(e){return e&&O(e.next)&&O(e.error)&&O(e.complete)}(n)&&A(n)?e:new H(e,t,r);return function(e){if(k.useDeprecatedSynchronousErrorHandling){var t=!L;if(t&&(L={errorThrown:!1,error:null}),e(),t){var r=L,n=r.errorThrown,o=r.error;if(L=null,n)throw o}}else e()}((function(){var e=o,t=e.operator,r=e.source;i.add(t?t.call(i,r):r?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=Z(t))((function(t,n){var o=new H({next:function(t){try{e(t)}catch(e){n(e),o.unsubscribe()}},error:n,complete:t});r.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Y]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return K(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Z(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function Z(e){var t;return null!==(t=null!=e?e:k.Promise)&&void 0!==t?t:Promise}var ee="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function te(e){if(e instanceof X)return e;if(null!=e){if(function(e){return O(e[Y])}(e))return a=e,new X((function(e){var t=a[Y]();if(O(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if((i=e)&&"number"==typeof i.length&&"function"!=typeof i)return o=e,new X((function(e){for(var t=0;t<o.length&&!e.closed;t++)e.next(o[t]);e.complete()}));if(O(null==(n=e)?void 0:n.then))return r=e,new X((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,C)}));if(function(e){return Symbol.asyncIterator&&O(null==e?void 0:e[Symbol.asyncIterator])}(e))return re(e);if(function(e){return O(null==e?void 0:e[ee])}(e))return t=e,new X((function(e){var r,n;try{for(var o=y(t),i=o.next();!i.done;i=o.next()){var a=i.value;if(e.next(a),e.closed)return}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}e.complete()}));if(function(e){return O(null==e?void 0:e.getReader)}(e))return re(function(e){return g(this,arguments,(function(){var t,r,n;return h(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,m(t.read())];case 3:return r=o.sent(),n=r.value,r.done?[4,m(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,m(n)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,r,n,o,i,a;throw function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(e)}function re(e){return new X((function(t){(function(e,t){var r,n,o,i;return d(this,void 0,void 0,(function(){var a,u;return h(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=_(e),c.label=1;case 1:return[4,r.next()];case 2:if((n=c.sent()).done)return[3,4];if(a=n.value,t.next(a),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=c.sent(),o={error:u},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function ne(e){return x((function(t,r){var n,o=null,i=!1;o=t.subscribe(J(r,void 0,void 0,(function(a){n=te(e(a,ne(e)(t))),o?(o.unsubscribe(),o=null,n.subscribe(r)):i=!0}))),i&&(o.unsubscribe(),o=null,n.subscribe(r))}))}function oe(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ie(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ie(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ue=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,o;return t=e,(r=[{key:"transformMetricFindResponse",value:function(e){var t=Object(n.toDataFrame)(e.data),r=[],o=t.fields.find((function(e){return"__text"===e.name})),i=t.fields.find((function(e){return"__value"===e.name}));if(o&&i)for(var a=0;a<o.values.length;a++)r.push({text:""+o.values.get(a),value:""+i.values.get(a)});else r.push.apply(r,oe(t.fields.flatMap((function(e){return e.values.toArray()})).map((function(e){return{text:e}}))));return Array.from(new Set(r.map((function(e){return e.text})))).map((function(e){var t;return{text:e,value:null===(t=r.find((function(t){return t.text===e})))||void 0===t?void 0:t.value}}))}}])&&ae(t.prototype,r),o&&ae(t,o),e}();function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=de(e);if(t){var o=de(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return pe(this,r)}}function pe(e,t){if(t&&("object"===ce(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function de(e){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var he=["adhoc","constant","custom","interval","query","textbox"],ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}(a,e);var t,r,o,i=fe(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).annotations={},t.responseParser=new ue,t.url=void 0===e.url?"":e.url,t.withCredentials=void 0!==e.withCredentials,t.headers={"Content-Type":"application/json"},"string"==typeof e.basicAuth&&e.basicAuth.length>0&&(t.headers.Authorization=e.basicAuth),t}return t=a,(r=[{key:"query",value:function(e){var t=this.processTargets(e);return 0===t.targets.length?Promise.resolve({data:[]}):(t.adhocFilters=Object(w.getTemplateSrv)().getAdhocFilters(this.name),e.scopedVars=Object.assign(Object.assign({},this.getVariables()),e.scopedVars),Object(S.lastValueFrom)(this.doFetch({url:"".concat(this.url,"/query"),data:t,method:"POST"}).pipe($((function(e){return e.data=e.data.map(n.toDataFrame),e})),ne((function(e){return Object(S.of)({data:[]})})))))}},{key:"testDatasource",value:function(){var e,t,r;return d(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,i,a,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o="Data source is not working",n.prev=1,n.next=4,Object(S.lastValueFrom)(this.doFetch({url:this.url,method:"GET"}).pipe($((function(e){return e}))));case 4:if(200!==(i=n.sent).status){n.next=7;break}return n.abrupt("return",{status:"success",message:"Data source is working",title:"Success"});case 7:return n.abrupt("return",{message:i.statusText?i.statusText:o,status:"error",title:"Error"});case 10:if(n.prev=10,n.t0=n.catch(1),"string"!=typeof n.t0){n.next=14;break}return n.abrupt("return",{status:"error",message:n.t0});case 14:return a=n.t0,u=null!==(e=a.statusText)&&void 0!==e?e:o,void 0!==(null===(r=null===(t=a.data)||void 0===t?void 0:t.error)||void 0===r?void 0:r.code)&&(u+=": ".concat(a.data.error.code,". ").concat(a.data.error.message)),n.abrupt("return",{status:"error",message:u,title:"Error"});case 18:case"end":return n.stop()}}),n,this,[[1,10]])})))}},{key:"metricFindQuery",value:function(e,t,r){var n=this,o={payload:"json"===e.format?JSON.parse(Object(w.getTemplateSrv)().replace(e.query,void 0,"json")):{type:r,target:Object(w.getTemplateSrv)().replace(e.query,void 0,"regex")},range:null==t?void 0:t.range,rangeRaw:null==t?void 0:t.rangeRaw};return Object(S.lastValueFrom)(this.doFetch({url:"".concat(this.url,"/variable"),data:o,method:"POST"}).pipe($((function(e){return n.responseParser.transformMetricFindResponse(e)})),ne((function(e){return Object(S.of)([])}))))}},{key:"listMetrics",value:function(e,t,r){var n=this;return Object(S.lastValueFrom)(this.doFetch({url:"".concat(this.url,"/search"),data:{type:r,target:Object(w.getTemplateSrv)().replace(e,void 0,"regex")},method:"POST"}).pipe($((function(e){return n.mapToTextValue(e)})),ne((function(e){return Object(S.of)([])}))))}},{key:"getTagKeys",value:function(e){return Object(S.lastValueFrom)(this.doFetch({url:"".concat(this.url,"/tag-keys"),method:"POST",data:e}).pipe($((function(e){return e.data})),ne((function(e){return Object(S.of)([])}))))}},{key:"getTagValues",value:function(e){return Object(S.lastValueFrom)(this.doFetch({url:"".concat(this.url,"/tag-values"),method:"POST",data:e}).pipe($((function(e){return e.data})),ne((function(e){return Object(S.of)([])}))))}},{key:"mapToTextValue",value:function(e){return e.data.map((function(e,t){return e&&e.text&&e.value?{text:e.text,value:e.value}:Object(u.isObject)(e)?{text:e,value:t}:{text:e,value:e}}))}},{key:"doFetch",value:function(e){return e.withCredentials=this.withCredentials,e.headers=this.headers,Object(w.getBackendSrv)().fetch(e)}},{key:"processTargets",value:function(e){var t=this;return e.targets=e.targets.filter((function(e){return void 0!==e.target})).map((function(r){return""!==r.payload.trim()&&(r.payload=r.payload.replace(Object(w.getTemplateSrv)().regex,(function(r){return t.cleanMatch(r,e)})),r.payload=JSON.parse(r.payload)),"string"==typeof r.target&&(r.target=Object(w.getTemplateSrv)().replace(r.target.toString(),e.scopedVars,"regex")),r})),e}},{key:"cleanMatch",value:function(e,t){var r=Object(w.getTemplateSrv)().replace(e,t.scopedVars,"json");return'"'===r[0]&&'"'===r[r.length-1]?JSON.parse(r):r}},{key:"getVariables",value:function(){var e={};return Object.values(Object(w.getTemplateSrv)().getVariables()).forEach((function(t){if(he.includes(t.type)&&"adhoc"!==t.type){var r=t,n=r.current.value;("$__all"===n||Object(u.isEqual)(n,["$__all"]))&&(n=null===r.allValue||""===r.allValue?r.options.slice(1).map((function(e){return e.value})):r.allValue),e[r.id]={text:r.current.text,value:n}}})),e}}])&&se(t.prototype,r),o&&se(t,o),a}(n.DataSourceApi);function ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return be(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,"plugin",(function(){return me}));var me=new n.DataSourcePlugin(ye).setConfigEditor((function(e){var t=e.options,r=e.onOptionsChange;return a.a.createElement(a.a.Fragment,null,a.a.createElement(o.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:t,showAccessOptions:!0,onChange:r}))})).setQueryEditor((function(e){var t,r=e.datasource,n=e.onChange,i=e.onRunQuery,l=e.query,f=s(a.a.useState(),2),p=f[0],d=f[1],h=s(a.a.useState(null!==(t=l.payload)&&void 0!==t?t:""),2),y=h[0],v=h[1],b=s(a.a.useState(null),2),m=b[0],g=b[1],_=s(a.a.useState([]),2),w=_[0],S=_[1],O=s(a.a.useState(!1),2),x=O[0],j=O[1],E=a.a.useCallback((function(){return r.listMetrics("",void 0).then((function(e){var t=e.map((function(e){return{label:e.text,value:e.value}})),r=Object(u.find)(t,(function(e){return e.value===l.target}));return d(void 0===r?{label:"",value:""}:r),t}),(function(e){throw d({label:"",value:""}),S([]),new Error(e.statusText)}))}),[r,l.target]),T=a.a.useCallback((function(){j(!0),E().then((function(e){S(e)})).finally((function(){j(!1)}))}),[E,S,j]);return a.a.useEffect((function(){return T()}),[]),a.a.useEffect((function(){void 0!==(null==p?void 0:p.value)&&""!==(null==p?void 0:p.value)&&(null!==m&&(null==p?void 0:p.value)===m.metric&&y===m.payload||(g({payload:y,metric:p.value.toString()}),n(Object.assign(Object.assign({},l),{payload:y,target:p.value.toString()})),i()))}),[y,p]),a.a.createElement(a.a.Fragment,null,a.a.createElement(o.InlineFieldRow,null,a.a.createElement(o.InlineField,null,a.a.createElement(o.Select,{isLoading:x,prefix:"Metric: ",options:w,placeholder:"Select metric",allowCustomValue:!0,value:p,onChange:function(e){d(e)}}))),a.a.createElement(o.InlineFieldRow,null,a.a.createElement(c.a,{disableHeight:!0},(function(e){var t=e.width;return a.a.createElement("div",{style:{width:t+"px"}},a.a.createElement(o.InlineLabel,null,"Payload"),a.a.createElement(o.CodeEditor,{width:"100%",height:"200px",language:"json",showLineNumbers:!0,showMiniMap:y.length>100,value:y,onBlur:function(e){return v(e)}}))}))))})).setVariableQueryEditor((function(e){var t,r=e.onChange,n=e.query,u=ve(Object(i.useState)(n),2),c=u[0],s=u[1],l=function(){r(c,"".concat(c.query)+"".concat("json"===c.format?" (JSON)":""))};return a.a.createElement(a.a.Fragment,null,a.a.createElement(o.InlineFieldRow,null,a.a.createElement(o.InlineField,{label:"Query",invalid:function(e){if("json"===e.format){var t=Object(w.getTemplateSrv)().replace(e.query,void 0,"json");try{JSON.parse(t)}catch(e){if(e instanceof Error&&"SyntaxError"===e.name)return!0;throw e}}return!1}(c),grow:!0},a.a.createElement(o.Input,{name:"query",onBlur:l,onChange:function(e){return s(Object.assign(Object.assign({},c),{query:e.currentTarget.value}))},value:c.query})),a.a.createElement(o.InlineField,{labelWidth:14,label:"Raw JSON",tooltip:"When enabled, the query string is parsed as a JSON object. Otherwise when disabled, the query string is placed into a 'target' key to create a JSON object."},a.a.createElement(o.InlineSwitch,{name:"format",onBlur:l,onChange:function(e){return s(Object.assign(Object.assign({},c),{format:e.currentTarget.checked?"json":"string"}))},value:(t=c.format,"json"===t)}))))}))}])}));
//# sourceMappingURL=module.js.map